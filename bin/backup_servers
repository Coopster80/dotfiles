#!/bin/bash

# General variables
BACKUP_USER="barrelmaker"
BACKUP_HOST="pollux"
HOME_DIR="/home/barrelmaker"

# Minecraft variables
MINECRAFT_FILENAME="mc-servers-$(date +%m-%d-%Y).lz4"
MINECRAFT_BACKUP_DESTINATION="/mnt/Backup/mc-servers"
MINECRAFT_BACKUP_SOURCE="mc-servers"

# Factorio variables
FACTORIO_FILENAME="factorio-servers-$(date +%m-%d-%Y).lz4"
FACTORIO_BACKUP_DESTINATION="/mnt/Backup/factorio-servers"
FACTORIO_BACKUP_SOURCE="factorio-servers"

if ssh -q ${BACKUP_HOST} [[ -f "${MINECRAFT_BACKUP_DESTINATION}/${MINECRAFT_FILENAME}" ]]
then
	echo "Minecraft Servers backup for today already complete"
else
	tar cf - -C "${HOME_DIR}" "${MINECRAFT_BACKUP_SOURCE}" | lz4 -1 - | ssh "${BACKUP_USER}@${BACKUP_HOST}" dd of="${MINECRAFT_BACKUP_DESTINATION}/${MINECRAFT_FILENAME}"
fi

if ssh -q ${BACKUP_HOST} [[ -f "${FACTORIO_BACKUP_DESTINATION}/${FACTORIO_FILENAME}" ]]
then
	echo "Factorio Servers backup for today already complete"
else
	tar cf - -C "${HOME_DIR}" "${FACTORIO_BACKUP_SOURCE}" | lz4 -1 - | ssh "${BACKUP_USER}@${BACKUP_HOST}" dd of="${FACTORIO_BACKUP_DESTINATION}/${FACTORIO_FILENAME}"
fi
